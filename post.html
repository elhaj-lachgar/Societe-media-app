<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="./node_modules/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="./css/all.min.css">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/bootstrap.min.css.map">
    
</head>
<body>
    

        <!-- start project -->
    <!-- part of html and styling  -->
    <!-- modale of login -->
    <div class="modal fade" id="login" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">Login</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="closeLogin"></button>
            </div>
            <div class="modal-body">
              <form>
                <div class="mb-3">
                  <label for="recipient-name" class="col-form-label">username</label>
                  <input type="text" class="form-control" id="loginUserame">
                </div>
                <div class="mb-3">
                  <label for="message-text" class="col-form-label">password</label>
                  <input type="password" class="form-control" id="loginPassword">
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary"  id="loginButton" >Login</button>
            </div>
          </div>
        </div>
      </div>


    <!--modale of register  -->

    <div class="modal fade" id="Register" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">Register</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="closeLogin"></button>
            </div>
            <div class="modal-body">
              <form>
                <div class="mb-3">
                  <label for="recipient-name" class="col-form-label">name</label>
                  <input type="text" class="form-control" id="Registername">
                </div>
                <div class="mb-3">
                    <label for="recipient-name" class="col-form-label">username</label>
                    <input type="text" class="form-control" id="RegisterUsername">
                </div>
                <div class="mb-3">
                    <label for="recipient-name" class="col-form-label">email</label>
                    <input type="email" class="form-control" id="Registeremail">
                </div>
                <div class="mb-3">
                  <label for="message-text" class="col-form-label">password</label>
                  <input type="password" class="form-control" id="Registerpassword">
                </div>
                <div class="mb-3">
                    <label for="message-text" class="col-form-label">profile_image</label>
                    <input type="file" class="form-control" id="Registerimage">
                  </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary"  id="Registerbtn"  >Register</button>
            </div>
          </div>
        </div>
      </div>

    <!-- create comments model  -->

    <div class="modal fade" id="createCommentModale" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">New message</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="closeCommentBtn"></button>
            </div>
            <div class="modal-body">
              <form>
                <div class="mb-3">
                  <label for="message-text" class="col-form-label">content</label>
                  <textarea class="form-control" id="contentComment"></textarea>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" id="newcomment">Add comment</button>
            </div>
          </div>
        </div>
      </div>






    <!-- nav bar -->

      <div class="container ">
        <div class="d-flex justify-content-center" style="width: 100%;">
            <div class="col-9">
                <nav class="navbar navbar-expand-lg bg-light shadow rounded" style="width: 100%; padding: 15px;">
                    <a class="navbar-brand" href="#">Navbar</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                      <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse position-relative" id="navbarNav" >
                      <ul class="navbar-nav">
                        <li class="nav-item">
                          <a class="nav-link active" aria-current="page" href="#">Home</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" href="#"> Profile</a>
                        </li>
                      </ul>
                      <div class="d-flex justify-content-end" style="width: 100%;" id="logingroupe">
                        <button class="btn btn-outline-primary me-2"data-bs-toggle="modal" data-bs-target="#login" data-bs-whatever="@mdo">Login</button>
                        <buttonn class="btn btn-outline-success"data-bs-toggle="modal" data-bs-target="#Register" data-bs-whatever="@mdo">Register</buttonn>
                      </div>
                      <div class="d-flex justify-content-end" style="width: 100%;display: none !important; " id="logoutgroupe">
                        <buttonn class="btn btn-outline-danger">logout</buttonn>
                      </div>
                    </div>
                </nav>
            </div>
        </div>
    </div>


    <div class="continer">
        <div class="d-flex justify-content-center" style="width: 100%;">
            <div class="col-7">
                <div class="posts mt-5" id="containerPosts">
                </div> 
               <div id="containerComments" class=" comment mt-5" id="containerPosts">
                </div>
            </div>
        </div>
    </div>



    <script src="./main.js"></script>
    <script>
            handlBtn()
            // get id from url
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            const id = urlParams.get('pageid')
            console.log(id);
            document.getElementById('newcomment').onclick = () =>{
                const token = window.localStorage.getItem("token");
                if( token  == undefined ){
                    alert('you can do this action because you have to login')
                }
                else{
                           
                    const url = `https://tarmeezacademy.com/api/v1/posts/${id}/comments`;
                    const content = document.getElementById('contentComment').value;
                    let form = new FormData;
                    form.append('body' , content);
                    header = {
                        "authorization" : `Bearer ${token}`
                    }
                    axios.post(url , form , {headers : header})
                    .then((res) =>{
                        alert("create commente successful ")
                        document.getElementById('closeCommentBtn').click()
                        window.location.reload(true)
                    })
                    .catch((err)=>console.log(err))   
                }
            }

            const containerComments = document.getElementById('containerComments');           
            function setupComment ( profile_image , username , body , time) {
                // create main div 

                const mainDiv = document.createElement('div');
                mainDiv.className ='card mb-3';
                

                // create row 

                const rowDiv = document.createElement('div');
                rowDiv.className ='row g-0';

                // create profile img of comment 

                const imgDiv = document.createElement('div');
                imgDiv.className ='col-md-8';

                const profile_img = document.createElement('img');
                profile_img.src = profile_image ;
                profile_img.className = 'img-fluid rounded-start';
                profile_img.style.setProperty('width','100px','important');
                profile_img.style.setProperty('height','100px','important');
                imgDiv.appendChild(profile_img);
                //  appending in row 

                rowDiv.appendChild(imgDiv);


                // create div content 

                const contentDiv = document.createElement('div');
                contentDiv.className = 'col-md-8';

                // create sup div of content 

                const supContentDiv = document.createElement('div');
                supContentDiv.className ='card-body';

                // create name of comment 


                const nameElement = document.createElement('h5');
                nameElement.className = 'card-title';
                nameElement.innerHTML = username;
                

                // create body of comment 

                const bodyElement = document.createElement('p');
                bodyElement.className = 'card-text';
                bodyElement.innerHTML = body;
                
                // create time of create 

                const timerElement = document.createElement('p');
                timerElement.className ='card-text';

                const small = document.createElement('small');
                small.className ='text-body';
                small.innerHTML = time;

                timerElement.appendChild(small);

                // appending in sup div 

                supContentDiv.appendChild(nameElement);
                supContentDiv.appendChild(bodyElement);
                supContentDiv.appendChild(timerElement);
                // appending in div of content 

                contentDiv.appendChild(supContentDiv);
                
                // appending in row div 

                rowDiv.appendChild(contentDiv);

                // appending in main div 

                mainDiv.appendChild(rowDiv);

                // appending in global div

                containerComments.appendChild(mainDiv);
            }
            document.getElementById("Registerbtn").onclick = ()=>{
            let url = `${BaseUrl}register`;
            // getting input values of register
            
            const username = document.getElementById('RegisterUsername').value;
            const name = document.getElementById('Registername').value;
            const email = document.getElementById('Registeremail').value;
            const password = document.getElementById('Registerpassword').value;
            const profile_image = document.getElementById('Registerimage').files[0];
            // appending data in formdata
            let container = new FormData();
            container.append("username",username);
            container.append('name',name);
            container.append('email',email);
            container.append('password',password);
            container.append('profile_image',profile_image);
            // send requiste and get response
            axios.post(url,container)
            .then((res)=>{
                window.localStorage.setItem("token" ,res.data.token);
                window.localStorage.setItem("user",JSON.stringify(res.data.user));
                handlBtn()
            })
            .catch((err)=>{
                console.log(err);
            })


        }

            document.getElementById("logoutgroupe").onclick = () => {
                window.localStorage.clear()
                alert("log out succes")
                handlBtn()
            }
        
        getPost(id)
        function getPost(id) {
            const url = `${BaseUrl}posts/${id}`
            axios.get(url)
            .then((response)=>{
                const post = response.data.data;
                console.log(post);
    // post.author.id ,post.id,post.author.username , post.author.profile_image , post.image , post.title , post.body , post.comments_count ,true ,false 
                setUpPosts( post.author.id,post.id,post.author.username , post.author.profile_image , post.image , post.title , post.body , post.comments_count ,false,false,false);
                const comments = post.comments;
                for( let comment of comments ){
                    setupComment(comment.author.profile_image , comment.author.username , comment.body ,comment.author.created_at )
                }

            })
            .catch((err)=>{
                console.log(err)
            })
         }



    </script>

</body>
    <!-- import script  -->
    <script src="./js/all.min.js"></script>
    <script src="./js/bootstrap.bundle.min.js"></script>
    <script src="./js/bootstrap.bundle.min.js.map"></script>
</html>